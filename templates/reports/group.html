{% extends "helpers/layout.html" %}
{% import 'helpers/navigation.html' as navigation %}

{% block title %}
    Submission Group - {{ assignment_group.name }}
{% endblock %}

{% block extrahead %}
<script>
    $(function() {
        let userIds = {{  request.values.get('user_ids')|tojson }} || getLocalStorage("BLOCKPY_SERVER_USERIDS", "");
        let assignmentIds = {{  request.values.get('assignment_ids')|tojson }} || getLocalStorage("BLOCKPY_SERVER_ASSIGNMENTIDS", "first");
        console.log(userIds, assignmentIds);
        ko.applyBindings({
            pageCourseId: {{ course_id|tojson }},
            userIds: userIds,
            assignmentIds: assignmentIds
        });
    });
</script>
{% endblock %}

{% set reduced_layout = embed or 'iframe' == request.form.get('launch_presentation_document_target') %}

{% block body %}

    {% if not reduced_layout %}
    <h1>Submissions</h1>
    {{ navigation.navigate_course() }}
    {% endif %}

    <assignment-group params="group: group"></assignment-group>
    <watcher params="courseId: pageCourseId, group: group, user: user, submissions: submissions"></watcher>

<h1>Overview</h1>

    <p>
    {% if reduced_layout %}
        Below, you can see your current submission for this assignment.<br>
        If you would like to continue attempting the assignment,
        you should return to the assignment from the Modules tab (if the assignment is not past its lock date).
        {% if referer %}
            This <a href="{{referer}}" target="_blank">direct link to the assignment</a> may work too.
        {% endif %}
    {% endif %}
    </p>

    <div>
        {% if is_grader or not any_hidden %}
        <div>Overall Status: {{ points_total }}/{{ points_possible }} problems</div>
        <div>Total Score: {{ score*100 }}%</div>
        {% else %}
            <div>Total Status/Score Hidden in this view because you are not a grader.</div>
        {% endif  %}
    </div>
<div>Contents:
    <ol>
        {% for assignment, submission in group %}
            <li><a href='#{{ assignment.slug() }}'>{{ assignment.name }}</a> - {{ submission.full_status() }}</li>
        {% endfor %}
    </ol>
</div>
<div>
    {% for assignment, submission in group %}
        {% if assignment.type.lower() == "blockpy" %}
            {% include "reports/blockpy.html" with context %}
        {% elif assignment.type.lower() == "maze" %}
            {% include "reports/maze.html" with context %}
        {% elif assignment.type.lower() == "reading" %}
            {% include "reports/reading.html" with context %}
        {% elif assignment.type.lower() == "quiz" %}
            {% include "reports/quiz.html" with context %}
        {% elif assignment.type.lower() == "java" %}
            {% include "reports/java.html" with context %}
        {% elif assignment.type.lower() == "textbook" %}
            {% include "reports/textbook.html" with context %}
        {% else %}
            Unknown assignment type.
        {% endif %}
    {% endfor  %}
</div>
<div>
<hr>
    <small>
        User: {{ user_id }}<br>
        Course: {{ course_id }}<br>
        Assignments: {{ group|join(',', attribute='0.id') }}<br>
        Submissions: {{ group|join(',', attribute='1.id') }}
    </small>
</div>

{% endblock %}