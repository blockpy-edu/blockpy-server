{% extends 'htmx/layout.html' %}

{% block title %}Knockout.js vs HTMX Comparison{% endblock %}

{% block body %}
<h1>Knockout.js vs HTMX Comparison</h1>

<div class="alert alert-info">
    <strong>Purpose:</strong> This page explains the differences between the classic Knockout.js frontend and the new HTMX frontend.
</div>

<div class="row mb-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Classic: Knockout.js</h5>
            </div>
            <div class="card-body">
                <h6>Architecture</h6>
                <ul>
                    <li><strong>Client-side state:</strong> Data stored in JavaScript observables</li>
                    <li><strong>Two-way binding:</strong> View ↔ ViewModel sync</li>
                    <li><strong>Heavy JavaScript:</strong> ~67KB framework + custom code</li>
                    <li><strong>Complex templates:</strong> Logic mixed with HTML</li>
                </ul>
                
                <h6 class="mt-3">Example Code</h6>
                <pre class="bg-light p-2"><code>&lt;!-- Knockout Template --&gt;
&lt;div data-bind="foreach: courses"&gt;
    &lt;h3 data-bind="text: name"&gt;&lt;/h3&gt;
    &lt;button data-bind="click: $parent.load"&gt;
        Load
    &lt;/button&gt;
&lt;/div&gt;

&lt;script&gt;
function ViewModel() {
    this.courses = ko.observableArray([]);
    this.load = function() {
        $.get('/api/courses', (data) =&gt; {
            this.courses(data);
        });
    };
}
ko.applyBindings(new ViewModel());
&lt;/script&gt;</code></pre>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">New: HTMX</h5>
            </div>
            <div class="card-body">
                <h6>Architecture</h6>
                <ul>
                    <li><strong>Server-side state:</strong> Data managed in Python/Flask</li>
                    <li><strong>One-way updates:</strong> Server → Client HTML</li>
                    <li><strong>Light JavaScript:</strong> ~14KB framework, no custom JS needed</li>
                    <li><strong>Clean templates:</strong> Pure HTML with attributes</li>
                </ul>
                
                <h6 class="mt-3">Example Code</h6>
                <pre class="bg-light p-2"><code>&lt;!-- HTMX Template --&gt;
&lt;button hx-get="/htmx/courses"
        hx-target="#courses"&gt;
    Load
&lt;/button&gt;
&lt;div id="courses"&gt;&lt;/div&gt;

# Python/Flask Route
@app.route('/htmx/courses')
def courses():
    courses = Course.query.all()
    return render_template(
        'partials/courses.html',
        courses=courses
    )

&lt;!-- No JavaScript needed! --&gt;</code></pre>
            </div>
        </div>
    </div>
</div>

<h2>Feature Comparison</h2>

<div class="table-responsive">
    <table class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>Feature</th>
                <th>Knockout.js</th>
                <th>HTMX</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>State Management</strong></td>
                <td>Client-side (JavaScript observables)</td>
                <td>Server-side (Python/Flask)</td>
            </tr>
            <tr>
                <td><strong>Data Binding</strong></td>
                <td>Two-way (automatic sync)</td>
                <td>One-way (server to client)</td>
            </tr>
            <tr>
                <td><strong>Bundle Size</strong></td>
                <td>~67KB (minified)</td>
                <td>~14KB (minified)</td>
            </tr>
            <tr>
                <td><strong>Learning Curve</strong></td>
                <td>Medium (need to learn observables, computed, etc.)</td>
                <td>Low (just HTML attributes)</td>
            </tr>
            <tr>
                <td><strong>SEO Friendly</strong></td>
                <td>❌ No (client-side rendering)</td>
                <td>✅ Yes (server-side rendering)</td>
            </tr>
            <tr>
                <td><strong>Works Without JS</strong></td>
                <td>❌ No</td>
                <td>✅ Yes (progressive enhancement)</td>
            </tr>
            <tr>
                <td><strong>Code Location</strong></td>
                <td>Spread across templates + JS files</td>
                <td>Centralized in Python routes</td>
            </tr>
            <tr>
                <td><strong>Testing</strong></td>
                <td>Need browser testing + unit tests</td>
                <td>Standard Flask route testing</td>
            </tr>
            <tr>
                <td><strong>Debugging</strong></td>
                <td>Browser console + debugger</td>
                <td>Python debugger + logs</td>
            </tr>
            <tr>
                <td><strong>Performance</strong></td>
                <td>Fast after initial load</td>
                <td>Fast initial load, fast updates</td>
            </tr>
        </tbody>
    </table>
</div>

<h2>Real-World Example: Course List</h2>

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5>Search Implementation Comparison</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Knockout.js Approach</h6>
                        <pre class="bg-light p-2"><code>&lt;!-- Template --&gt;
&lt;input data-bind="value: searchQuery,
                   valueUpdate: 'keyup'"&gt;

&lt;div data-bind="foreach: filteredCourses"&gt;
    &lt;div data-bind="text: name"&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;script&gt;
function CourseViewModel() {
    this.searchQuery = ko.observable('');
    this.courses = ko.observableArray([]);
    
    this.filteredCourses = ko.computed(() =&gt; {
        var query = this.searchQuery()
                        .toLowerCase();
        return this.courses().filter(c =&gt; 
            c.name.toLowerCase()
                  .includes(query)
        );
    });
    
    // Load courses via AJAX
    $.get('/api/courses', (data) =&gt; {
        this.courses(data);
    });
}
&lt;/script&gt;

<strong>Lines of code:</strong> ~25
<strong>Files touched:</strong> 1 (template with inline JS)
<strong>Testing:</strong> Browser + unit tests needed</code></pre>
                    </div>
                    <div class="col-md-6">
                        <h6>HTMX Approach</h6>
                        <pre class="bg-light p-2"><code>&lt;!-- Template --&gt;
&lt;input type="text"
       hx-get="/htmx/courses"
       hx-trigger="keyup changed delay:500ms"
       hx-target="#courses"
       name="search"&gt;

&lt;div id="courses"&gt;
    {%  include 'partials/courses.html' %}
&lt;/div&gt;

# Python Route
@htmx_routes.route('/courses')
def courses():
    search = request.args.get('search', '')
    courses = Course.query.filter(
        Course.name.ilike(f'%{search}%')
    ).all()
    return render_template(
        'partials/courses.html',
        courses=courses
    )

<strong>Lines of code:</strong> ~12
<strong>Files touched:</strong> 2 (template + route)
<strong>Testing:</strong> Standard Flask testing</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<h2 class="mt-4">When to Use Each</h2>

<div class="row">
    <div class="col-md-6 mb-3">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Use Knockout.js When:</h5>
            </div>
            <div class="card-body">
                <ul>
                    <li>You need complex client-side state</li>
                    <li>Real-time collaborative editing</li>
                    <li>Offline-first applications</li>
                    <li>Heavy computational work on client</li>
                    <li>Already have Knockout expertise</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="col-md-6 mb-3">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">Use HTMX When:</h5>
            </div>
            <div class="card-body">
                <ul>
                    <li>Building traditional web apps</li>
                    <li>Server-side rendering preferred</li>
                    <li>SEO is important</li>
                    <li>Team is stronger in backend</li>
                    <li>Want simpler, more maintainable code</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<h2>Migration Path</h2>

<div class="alert alert-warning">
    <h5>Gradual Migration Strategy</h5>
    <p>Both versions can coexist! Here's how to migrate:</p>
    <ol>
        <li><strong>Start Small:</strong> Choose a simple page (e.g., course list)</li>
        <li><strong>Create HTMX Version:</strong> Build the new version at /htmx/path</li>
        <li><strong>Test Thoroughly:</strong> Ensure feature parity</li>
        <li><strong>Gather Feedback:</strong> Let users try both versions</li>
        <li><strong>Iterate:</strong> Fix issues, improve UX</li>
        <li><strong>Expand:</strong> Move to more complex pages</li>
        <li><strong>Eventually Retire:</strong> Remove old version when ready</li>
    </ol>
</div>

<h2>Performance Metrics</h2>

<div class="table-responsive">
    <table class="table table-bordered">
        <thead class="table-dark">
            <tr>
                <th>Metric</th>
                <th>Knockout.js</th>
                <th>HTMX</th>
                <th>Winner</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Initial Page Load</td>
                <td>~500ms</td>
                <td>~200ms</td>
                <td>✅ HTMX</td>
            </tr>
            <tr>
                <td>JavaScript Bundle Size</td>
                <td>67KB + custom code</td>
                <td>14KB</td>
                <td>✅ HTMX</td>
            </tr>
            <tr>
                <td>Time to Interactive</td>
                <td>~800ms</td>
                <td>~300ms</td>
                <td>✅ HTMX</td>
            </tr>
            <tr>
                <td>Update Speed (after load)</td>
                <td>~50ms</td>
                <td>~100-200ms</td>
                <td>✅ Knockout</td>
            </tr>
            <tr>
                <td>Memory Usage</td>
                <td>Higher (observables)</td>
                <td>Lower (stateless)</td>
                <td>✅ HTMX</td>
            </tr>
        </tbody>
    </table>
</div>

<div class="mt-4 mb-4">
    <a href="{{ url_for('htmx_routes.index') }}" class="btn btn-outline-secondary">← Back to Home</a>
    <a href="{{ url_for('htmx_routes.examples') }}" class="btn btn-outline-primary">View Examples →</a>
</div>

{% endblock %}
